create database if not exists order1;

use order1;

drop table if exists ORDERS;
drop table if exists CUSTOMER1;
drop table if exists SALESMAN;

CREATE TABLE if not exists SALESMAN
(SALESMAN_ID int (4),
NAME VARCHAR (20),
CITY VARCHAR (20),
COMMISSION VARCHAR (20),
PRIMARY KEY (SALESMAN_ID));

CREATE TABLE CUSTOMER1
(CUSTOMER_ID int (4),
CUST_NAME VARCHAR (20),
CITY VARCHAR (20),
GRADE INT (3),
SALESMAN_ID int (4),
PRIMARY KEY (CUSTOMER_ID),
FOREIGN KEY(SALESMAN_ID) REFERENCES SALESMAN (SALESMAN_ID) ON DELETE SET NULL);

CREATE TABLE ORDERS
(ORD_NO int (5),
PURCHASE_AMT decimal (10, 2),
ORD_DATE DATE,
CUSTOMER_ID int (4),
SALESMAN_ID int (4),
PRIMARY KEY (ORD_NO),
FOREIGN KEY(CUSTOMER_ID) REFERENCES CUSTOMER1 (CUSTOMER_ID) ON DELETE CASCADE,
FOREIGN KEY(SALESMAN_ID) REFERENCES SALESMAN (SALESMAN_ID) ON DELETE CASCADE);



INSERT INTO SALESMAN VALUES (1000, 'JOHN','BANGALORE','25 %');
INSERT INTO SALESMAN VALUES (2000, 'RAVI','BANGALORE','20 %');
INSERT INTO SALESMAN VALUES (3000, 'KUMAR','MYSORE','15 %');
INSERT INTO SALESMAN VALUES (4000, 'SMITH','DELHI','30 %');
INSERT INTO SALESMAN VALUES (5000, 'HARSHA','HYDRABAD','15 %');

INSERT INTO CUSTOMER1 VALUES (10, 'PREETHI','BANGALORE', 100, 1000);
INSERT INTO CUSTOMER1 VALUES (11, 'VIVEK','MANGALORE', 300, 1000);
INSERT INTO CUSTOMER1 VALUES (12, 'BHASKAR','CHENNAI', 400, 2000);
INSERT INTO CUSTOMER1 VALUES (13, 'CHETHAN','BANGALORE', 200, 2000);
INSERT INTO CUSTOMER1 VALUES (14, 'MAMATHA','BANGALORE', 400, 3000);

INSERT INTO ORDERS VALUES (50, 5000, '2017-05-04', 10, 1000);
INSERT INTO ORDERS VALUES (51, 450, '2017-01-20', 10, 2000);
INSERT INTO ORDERS VALUES (52, 1000, '2017-02-24', 13, 2000);
INSERT INTO ORDERS VALUES (53, 3500, '2017-04-13', 14, 3000);
INSERT INTO ORDERS VALUES (54, 550, '2017-03-09', 12, 2000);

drop view if exists v_public;

create view v_public as select ORD_NO,ORD_DATE from ORDERS;

#select * from CUSTOMER1;
select * from SALESMAN;
#select * from ORDERS;

DROP TRIGGER IF EXISTS insertion_trigger; 
CREATE TRIGGER insertion_trigger 
before insert on SALESMAN 
for each row
set new.NAME = lower(NEW.NAME);  
/*
DROP TRIGGER IF EXISTS update_trigger; 
CREATE TRIGGER update_trigger 
after insert on SALESMAN 
for each row
set CITY="BANGALORE";
*/


insert into SALESMAN(SALESMAN_ID, NAME) values(7000, "DAVID");
select * from SALESMAN ORDER BY NAME;
ALTER TABLE SALESMAN DROP COMMISSION cascade;
select * from SALESMAN ORDER BY NAME;



